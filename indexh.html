<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Management System | Telenor</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0054a6 0%, #00a0df 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            box-shadow: 0 30px 70px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #0054a6;
        }
        
        .logo h1 {
            font-size: 2.2em;
            color: #0054a6;
        }
        
        .logo span {
            color: #00a0df;
            font-size: 0.9em;
        }
        
        .search-section {
            background: #f0f8ff;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid #cce5ff;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        
        .search-box input {
            flex: 1;
            min-width: 300px;
            padding: 18px 25px;
            font-size: 1.2em;
            border: 3px solid #0054a6;
            border-radius: 60px;
            outline: none;
        }
        
        .search-box button {
            padding: 18px 45px;
            font-size: 1.2em;
            background: #0054a6;
            color: white;
            border: none;
            border-radius: 60px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        
        .search-box button:hover {
            background: #003d7a;
            transform: scale(1.05);
        }
        
        .section-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        
        .section-card h3 {
            color: #0054a6;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #00a0df;
            font-size: 1.6em;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 1em;
            transition: 0.3s;
            background: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: #00a0df;
            box-shadow: 0 0 0 3px rgba(0,160,223,0.2);
            outline: none;
        }
        
        .neighbor-entry {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 15px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 12px;
        }
        
        .btn-add {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .btn-add:hover {
            background: #218838;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .btn-remove:hover {
            background: #c82333;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #0054a6, #00a0df);
            color: white;
            border: none;
            padding: 20px 80px;
            font-size: 1.5em;
            border-radius: 60px;
            cursor: pointer;
            font-weight: bold;
            margin: 40px 0 20px;
            box-shadow: 0 10px 20px rgba(0,84,166,0.3);
            transition: 0.3s;
        }
        
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,84,166,0.4);
        }
        
        .message-box {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: bold;
            text-align: center;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            display: block;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
            display: block;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
            color: #666;
        }
        
        .required-field::after {
            content: " *";
            color: red;
        }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .search-box input { min-width: 100%; }
            .btn-submit { width: 100%; padding: 20px; }
            .neighbor-entry { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <h1>üèóÔ∏è TOWER MANAGEMENT SYSTEM</h1>
                <span>Telenor Pakistan | Site Inventory</span>
            </div>
            <div>üÜî Version 3.0</div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <h2 style="text-align: center; margin-bottom: 25px;">üîç Enter Tower ID</h2>
            <div class="search-box">
                <input type="text" id="towerId" placeholder="e.g., TWR-001, ISB-234, KHI-789">
                <button onclick="loadTowerData()">üìÇ Load / Create Tower</button>
            </div>
            <div id="searchMessage" class="message-box"></div>
        </div>

        <!-- Data Form -->
        <div id="dataSection" style="display: none;">
            <form id="towerForm">
                <input type="hidden" id="formTowerId" name="towerId">

                <!-- 1. Basic Info -->
                <div class="section-card">
                    <h3>1. üìç BASIC INFORMATION</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required-field">Tower ID</label>
                            <input type="text" id="basicTowerId" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Complete Address</label>
                            <input type="text" id="address" placeholder="Enter full address">
                        </div>
                        <div class="form-group">
                            <label>Latitude</label>
                            <input type="text" id="latitude" placeholder="e.g., 24.8607">
                        </div>
                        <div class="form-group">
                            <label>Longitude</label>
                            <input type="text" id="longitude" placeholder="e.g., 67.0011">
                        </div>
                        <div class="form-group">
                            <label>Operator</label>
                            <input type="text" id="operator" value="Telenor" readonly>
                        </div>
                        <div class="form-group">
                            <label>Technology Generation</label>
                            <select id="technology">
                                <option value="">-- Select Generation --</option>
                                <option value="2G">2G Only</option>
                                <option value="3G">3G (Includes 2G)</option>
                                <option value="4G">4G (Includes 2G, 3G)</option>
                                <option value="5G">5G (Includes 2G, 3G, 4G)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 2. Ownership -->
                <div class="section-card">
                    <h3>2. ü§ù OWNERSHIP & SHARING</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ownership Type</label>
                            <select id="ownershipType" onchange="toggleSharingFields()">
                                <option value="">-- Select Ownership --</option>
                                <option value="Own">TP Own</option>
                                <option value="Shared">TP Shared With</option>
                            </select>
                        </div>
                        <div class="form-group" id="sharingPartnerGroup" style="display: none;">
                            <label>Sharing Partner Company</label>
                            <input type="text" id="sharingPartner" placeholder="Enter company name">
                        </div>
                        <div class="form-group" id="sharingTypeGroup" style="display: none;">
                            <label>Sharing Type</label>
                            <select id="sharingType">
                                <option value="">-- Select Sharing Type --</option>
                                <option value="DC">DC Share</option>
                                <option value="AC">AC Share</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 3. Electrical -->
                <div class="section-card">
                    <h3>3. ‚ö° ELECTRICAL INFRASTRUCTURE</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Grid Availability</label>
                            <select id="gridAvailability">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Pole Type</label>
                            <select id="poleType">
                                <option value="">-- Select --</option>
                                <option value="Concrete">Concrete</option>
                                <option value="Steel">Steel</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Transformer Capacity (kW)</label>
                            <input type="number" id="transformerCapacity" placeholder="Enter capacity">
                        </div>
                        <div class="form-group">
                            <label>Transformer Ownership</label>
                            <select id="transformerOwnership">
                                <option value="">-- Select --</option>
                                <option value="Own">Own</option>
                                <option value="Public">Public</option>
                                <option value="Shared">Shared</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>3-Phase DC Link</label>
                            <select id="dcLink">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Energy Meter Present</label>
                            <select id="meterPresent" onchange="toggleMeterFields()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group" id="meterStatusGroup" style="display: none;">
                            <label>Meter Status</label>
                            <select id="meterStatus">
                                <option value="">-- Select --</option>
                                <option value="Working">Working</option>
                                <option value="Faulty">Faulty</option>
                            </select>
                        </div>
                        <div class="form-group" id="meterReferenceGroup" style="display: none;">
                            <label>Meter Reference Number</label>
                            <input type="text" id="meterReference" placeholder="Enter meter number">
                        </div>
                        <div class="form-group">
                            <label>Number of Earth Rods</label>
                            <input type="number" id="earthRods" placeholder="Enter quantity" min="0">
                        </div>
                    </div>
                </div>

                <!-- 4. Generator -->
                <div class="section-card">
                    <h3>4. üîß GENERATOR</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Generator Present</label>
                            <select id="generatorPresent" onchange="toggleGeneratorFields()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="generatorFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Condition</label>
                                <select id="generatorCondition">
                                    <option value="">-- Select --</option>
                                    <option value="Operational">Operational</option>
                                    <option value="Faulty">Faulty</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Brand</label>
                                <input type="text" id="generatorBrand" placeholder="Enter brand">
                            </div>
                            <div class="form-group">
                                <label>Power (kW)</label>
                                <input type="number" id="generatorPower" placeholder="Enter power">
                            </div>
                            <div class="form-group">
                                <label>Oil Capacity (Liters)</label>
                                <input type="number" id="oilCapacity" placeholder="Enter oil capacity">
                            </div>
                            <div class="form-group">
                                <label>Last Oil Change Date</label>
                                <input type="date" id="lastOilChange">
                            </div>
                            <div class="form-group">
                                <label>Battery</label>
                                <select id="generatorBattery">
                                    <option value="">-- Select --</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Static Charger</label>
                                <select id="staticCharger">
                                    <option value="">-- Select --</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Solo Night Feature</label>
                                <select id="soloNight">
                                    <option value="">-- Select --</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Oil Safety</label>
                                <select id="oilSafety">
                                    <option value="">-- Select --</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fuel Safety</label>
                                <select id="fuelSafety">
                                    <option value="">-- Select --</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Engine Number</label>
                                <input type="text" id="engineNumber" placeholder="Enter engine number">
                            </div>
                            <div class="form-group">
                                <label>Serial Number</label>
                                <input type="text" id="generatorSerial" placeholder="Enter serial number">
                            </div>
                            <div class="form-group">
                                <label>Noise Level</label>
                                <select id="noiseLevel">
                                    <option value="">-- Select --</option>
                                    <option value="Normal">Normal</option>
                                    <option value="Loud">Loud</option>
                                    <option value="Abnormal">Abnormal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. Rectifier -->
                <div class="section-card">
                    <h3>5. ‚öôÔ∏è RECTIFIER</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Number of Modules</label>
                            <input type="number" id="rectifierModules" placeholder="Enter number" min="0">
                        </div>
                        <div class="form-group">
                            <label>Module Power (W)</label>
                            <input type="number" id="modulePower" placeholder="Default 3000W" value="3000">
                        </div>
                        <div class="form-group">
                            <label>AC SPD Present</label>
                            <select id="acSpdPresent" onchange="toggleAcSpdBrand()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group" id="acSpdBrandGroup" style="display: none;">
                            <label>AC SPD Brand</label>
                            <input type="text" id="acSpdBrand" placeholder="Enter brand">
                        </div>
                        <div class="form-group">
                            <label>DC SPD Present</label>
                            <select id="dcSpdPresent" onchange="toggleDcSpdBrand()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group" id="dcSpdBrandGroup" style="display: none;">
                            <label>DC SPD Brand</label>
                            <input type="text" id="dcSpdBrand" placeholder="Enter brand">
                        </div>
                        <div class="form-group">
                            <label>Cooling Fan</label>
                            <select id="coolingFan">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 6. Battery Bank -->
                <div class="section-card">
                    <h3>6. üîã BATTERY BANK</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Configuration</label>
                            <select id="batteryConfig">
                                <option value="">-- Select --</option>
                                <option value="Bank">Battery Bank</option>
                                <option value="DC Share">DC Share</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Number of Banks</label>
                            <input type="number" id="numberOfBanks" placeholder="Enter number" min="0">
                        </div>
                        <div class="form-group">
                            <label>Bank Capacity (Ah)</label>
                            <input type="number" id="bankCapacity" placeholder="Enter capacity" value="400">
                        </div>
                        <div class="form-group">
                            <label>LLVD Value (V)</label>
                            <input type="number" id="llvdValue" step="0.1" placeholder="Enter voltage">
                        </div>
                        <div class="form-group">
                            <label>BLVD Value (V)</label>
                            <input type="number" id="blvdValue" step="0.1" placeholder="Enter voltage">
                        </div>
                        <div class="form-group">
                            <label>Battery Voltage (V)</label>
                            <input type="number" id="batteryVoltage" placeholder="Enter voltage">
                        </div>
                        <div class="form-group">
                            <label>Backup Time (Hours)</label>
                            <input type="number" id="backupTime" step="0.1" placeholder="Enter hours">
                        </div>
                        <div class="form-group">
                            <label>Site Load</label>
                            <input type="text" id="siteLoad" placeholder="e.g., 50A or 5kW">
                        </div>
                    </div>
                </div>

                <!-- 7. Diesel Tank -->
                <div class="section-card">
                    <h3>7. ‚õΩ DIESEL TANK</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tank Present</label>
                            <select id="tankPresent" onchange="toggleTankFields()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="tankFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Tank Type</label>
                                <select id="tankType">
                                    <option value="">-- Select --</option>
                                    <option value="Internal">Internal</option>
                                    <option value="External">External</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Capacity (Liters)</label>
                                <input type="number" id="tankCapacity" placeholder="Enter capacity">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 8. Solar -->
                <div class="section-card">
                    <h3>8. ‚òÄÔ∏è SOLAR SYSTEM</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Solar Present</label>
                            <select id="solarPresent" onchange="toggleSolarFields()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="solarFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Total Capacity (kW)</label>
                                <input type="number" id="solarCapacity" step="0.1" placeholder="Enter capacity">
                            </div>
                            <div class="form-group">
                                <label>Total Panels</label>
                                <input type="number" id="totalPanels" placeholder="Enter number">
                            </div>
                            <div class="form-group">
                                <label>Operational Panels</label>
                                <input type="number" id="operationalPanels" placeholder="Enter number">
                            </div>
                            <div class="form-group">
                                <label>Faulty Panels</label>
                                <input type="number" id="faultyPanels" placeholder="Enter number">
                            </div>
                            <div class="form-group">
                                <label>Junction Boxes</label>
                                <input type="number" id="junctionBoxes" placeholder="Enter number">
                            </div>
                            <div class="form-group">
                                <label>Solar PU Modules in Rectifier</label>
                                <input type="number" id="solarPuModules" placeholder="Enter number">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 9. Site Type -->
                <div class="section-card">
                    <h3>9. üè¢ SITE CLASSIFICATION</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Site Type</label>
                            <select id="siteType" onchange="toggleSiteTypeFields()">
                                <option value="">-- Select --</option>
                                <option value="Single">Single Site</option>
                                <option value="PTN">PTN Site</option>
                                <option value="Hub">Hub Site</option>
                                <option value="Mega Hub">Mega Hub</option>
                            </select>
                        </div>
                        <div class="form-group" id="parentSiteGroup" style="display: none;">
                            <label>Parent Site(s)</label>
                            <input type="text" id="parentSites" placeholder="Comma separated IDs">
                        </div>
                        <div class="form-group" id="childSitesGroup" style="display: none;">
                            <label>Child Site(s)</label>
                            <input type="text" id="childSites" placeholder="Comma separated IDs">
                        </div>
                    </div>
                </div>

                <!-- 10. BTS -->
                <div class="section-card">
                    <h3>10. üì° BTS EQUIPMENT</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>BTS Vendor</label>
                            <select id="btsVendor">
                                <option value="">-- Select --</option>
                                <option value="Huawei">Huawei</option>
                                <option value="ZTE">ZTE</option>
                                <option value="Ericsson">Ericsson</option>
                                <option value="Nokia">Nokia</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Total Sectors</label>
                            <input type="number" id="totalSectors" min="1" max="6" placeholder="Enter number" onchange="generateSectors()">
                        </div>
                    </div>
                    <div id="sectorsContainer" class="form-grid" style="margin-top: 20px;"></div>
                </div>

                <!-- 11. RRU -->
                <div class="section-card">
                    <h3>11. üìª RRU (Remote Radio Unit)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Total RRUs</label>
                            <input type="number" id="totalRrus" min="0" placeholder="Enter number" onchange="generateRRUs()">
                        </div>
                    </div>
                    <div id="rrusContainer" class="form-grid" style="margin-top: 20px;"></div>
                </div>

                <!-- 12. RSU -->
                <div class="section-card">
                    <h3>12. üîå RSU (Remote Switching Unit)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>RSU Present</label>
                            <select id="rsuPresent" onchange="toggleRsuFields()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="rsuFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>RSU Vendor</label>
                                <input type="text" id="rsuVendor" placeholder="Enter vendor">
                            </div>
                            <div class="form-group">
                                <label>Condition</label>
                                <select id="rsuCondition">
                                    <option value="">-- Select --</option>
                                    <option value="Operational">Operational</option>
                                    <option value="Faulty">Faulty</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Number of Ports</label>
                                <input type="number" id="rsuPorts" placeholder="Enter number">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 13. Maintenance -->
                <div class="section-card">
                    <h3>13. üõ†Ô∏è MAINTENANCE</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Last Maintenance Date</label>
                            <input type="date" id="lastMaintenance">
                        </div>
                    </div>
                </div>

                <!-- 14. Contacts -->
                <div class="section-card">
                    <h3>14. üë• KEY HOLDER & NEIGHBORS</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Key Holder Name</label>
                            <input type="text" id="keyHolderName" placeholder="Enter name">
                        </div>
                        <div class="form-group">
                            <label>Key Holder Phone</label>
                            <input type="tel" id="keyHolderPhone" placeholder="Enter phone number">
                        </div>
                    </div>
                    <div id="neighborsList"></div>
                    <button type="button" class="btn-add" onclick="addNeighbor()">‚ûï Add Neighbor</button>
                </div>

                <!-- 15. Other Companies -->
                <div class="section-card">
                    <h3>15. üè¢ OTHER COMPANIES (Co-location)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Other Companies Present</label>
                            <select id="otherCompaniesPresent" onchange="toggleOtherCompaniesFields()">
                                <option value="">-- Select --</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="otherCompaniesFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Company Name</label>
                                <input type="text" id="otherCompanyName" placeholder="Enter company name">
                            </div>
                            <div class="form-group">
                                <label>Sharing Type</label>
                                <select id="otherSharingType">
                                    <option value="">-- Select --</option>
                                    <option value="DC">DC Share</option>
                                    <option value="AC">AC Share</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div style="text-align: center;">
                    <button type="submit" class="btn-submit">üíæ SAVE TOWER DATA</button>
                </div>
                <div id="saveMessage" class="message-box"></div>
            </form>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>¬© 2024 Telenor Pakistan - Tower Management System | Version 3.0</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Enter only the information you have. Empty fields will be saved as null.</p>
        </div>
    </div>

    <script>
        // MongoDB Connection String
        const MONGODB_URI = 'mongodb+srv://hassanbhutta174_db_user:ZKCe9ktcgSDVYYOk@cluster0.95zq4qu.mongodb.net/?appName=Cluster0';
        
        // Local storage for demo (replace with actual API calls)
        let towerDatabase = {};

        // ==================== UI CONTROL FUNCTIONS ====================
        function showMessage(elementId, message, type) {
            const msgBox = document.getElementById(elementId);
            msgBox.textContent = message;
            msgBox.className = `message-box ${type}`;
            msgBox.style.display = 'block';
            setTimeout(() => {
                msgBox.style.display = 'none';
            }, 5000);
        }

        function toggleSharingFields() {
            const val = document.getElementById('ownershipType').value;
            document.getElementById('sharingPartnerGroup').style.display = val === 'Shared' ? 'block' : 'none';
            document.getElementById('sharingTypeGroup').style.display = val === 'Shared' ? 'block' : 'none';
        }

        function toggleMeterFields() {
            const val = document.getElementById('meterPresent').value;
            document.getElementById('meterStatusGroup').style.display = val === 'Yes' ? 'block' : 'none';
            document.getElementById('meterReferenceGroup').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleGeneratorFields() {
            const val = document.getElementById('generatorPresent').value;
            document.getElementById('generatorFields').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleAcSpdBrand() {
            const val = document.getElementById('acSpdPresent').value;
            document.getElementById('acSpdBrandGroup').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleDcSpdBrand() {
            const val = document.getElementById('dcSpdPresent').value;
            document.getElementById('dcSpdBrandGroup').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleTankFields() {
            const val = document.getElementById('tankPresent').value;
            document.getElementById('tankFields').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleSolarFields() {
            const val = document.getElementById('solarPresent').value;
            document.getElementById('solarFields').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleSiteTypeFields() {
            const type = document.getElementById('siteType').value;
            const parentGroup = document.getElementById('parentSiteGroup');
            const childGroup = document.getElementById('childSitesGroup');
            
            parentGroup.style.display = 'none';
            childGroup.style.display = 'none';
            
            if (type === 'Single') {
                parentGroup.style.display = 'block';
            } else if (type === 'PTN') {
                childGroup.style.display = 'block';
            } else if (type === 'Hub' || type === 'Mega Hub') {
                parentGroup.style.display = 'block';
                childGroup.style.display = 'block';
            }
        }

        function toggleRsuFields() {
            const val = document.getElementById('rsuPresent').value;
            document.getElementById('rsuFields').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function toggleOtherCompaniesFields() {
            const val = document.getElementById('otherCompaniesPresent').value;
            document.getElementById('otherCompaniesFields').style.display = val === 'Yes' ? 'block' : 'none';
        }

        function generateSectors() {
            const count = parseInt(document.getElementById('totalSectors').value) || 0;
            let html = '';
            for (let i = 1; i <= count; i++) {
                html += `
                    <div class="form-group">
                        <label>Sector ${i} Configuration</label>
                        <select name="sector${i}" class="sector-select">
                            <option value="">-- Select --</option>
                            <option value="2G">2G</option>
                            <option value="3G">3G</option>
                            <option value="4G">4G</option>
                            <option value="5G">5G</option>
                        </select>
                    </div>
                `;
            }
            document.getElementById('sectorsContainer').innerHTML = html;
        }

        function generateRRUs() {
            const count = parseInt(document.getElementById('totalRrus').value) || 0;
            let html = '';
            for (let i = 1; i <= count; i++) {
                html += `
                    <div class="form-group">
                        <label>RRU ${i} Frequency</label>
                        <select name="rru${i}" class="rru-select">
                            <option value="">-- Select --</option>
                            <option value="900">900 MHz (2G)</option>
                            <option value="1800">1800 MHz (3G)</option>
                            <option value="2100">2100 MHz (4G)</option>
                            <option value="2300">2300 MHz (5G)</option>
                            <option value="2600">2600 MHz (5G)</option>
                        </select>
                    </div>
                `;
            }
            document.getElementById('rrusContainer').innerHTML = html;
        }

        function addNeighbor() {
            const container = document.getElementById('neighborsList');
            const div = document.createElement('div');
            div.className = 'neighbor-entry';
            div.innerHTML = `
                <input type="text" name="neighborName[]" placeholder="Neighbor Name">
                <input type="tel" name="neighborPhone[]" placeholder="Phone Number">
                <button type="button" class="btn-remove" onclick="this.parentElement.remove()">‚úñ</button>
            `;
            container.appendChild(div);
        }

        // ==================== LOAD TOWER DATA ====================
        function loadTowerData() {
            const towerId = document.getElementById('towerId').value.trim();
            
            if (!towerId) {
                showMessage('searchMessage', 'Please enter a Tower ID', 'error');
                return;
            }

            // Set the tower ID in the form
            document.getElementById('formTowerId').value = towerId;
            document.getElementById('basicTowerId').value = towerId;

            // Check if tower exists in database (mock)
            if (towerDatabase[towerId]) {
                // Load existing data
                const data = towerDatabase[towerId];
                
                // Populate all fields with existing data
                for (let key in data) {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'select-one') {
                            element.value = data[key] || '';
                        } else {
                            element.value = data[key] || '';
                        }
                    }
                }
                
                showMessage('searchMessage', `‚úÖ Tower ${towerId} loaded successfully`, 'success');
            } else {
                // New tower - clear all fields
                document.getElementById('towerForm').reset();
                document.getElementById('basicTowerId').value = towerId;
                document.getElementById('operator').value = 'Telenor';
                document.getElementById('modulePower').value = '3000';
                document.getElementById('bankCapacity').value = '400';
                
                showMessage('searchMessage', `üÜï New Tower ID: ${towerId}. Fill in the information you have.`, 'info');
            }

            document.getElementById('dataSection').style.display = 'block';
            document.getElementById('dataSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ==================== SAVE TOWER DATA ====================
        document.getElementById('towerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const towerId = document.getElementById('formTowerId').value;
            
            // Collect all form data (only non-empty values)
            const formData = new FormData(this);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                // Only include fields that have values
                if (value && value.trim() !== '') {
                    data[key] = value;
                }
            }
            
            // Add tower ID
            data.towerId = towerId;
            
            // Collect sector configurations
            const sectors = [];
            const sectorSelects = document.querySelectorAll('.sector-select');
            sectorSelects.forEach((select, index) => {
                if (select.value) {
                    sectors.push({
                        number: index + 1,
                        configuration: select.value
                    });
                }
            });
            if (sectors.length > 0) {
                data.sectors = sectors;
            }
            
            // Collect RRU frequencies
            const rrus = [];
            const rruSelects = document.querySelectorAll('.rru-select');
            rruSelects.forEach((select, index) => {
                if (select.value) {
                    rrus.push({
                        number: index + 1,
                        frequency: select.value
                    });
                }
            });
            if (rrus.length > 0) {
                data.rrus = rrus;
            }
            
            // Collect neighbors
            const neighbors = [];
            const neighborNames = document.querySelectorAll('input[name="neighborName[]"]');
            const neighborPhones = document.querySelectorAll('input[name="neighborPhone[]"]');
            
            for (let i = 0; i < neighborNames.length; i++) {
                if (neighborNames[i].value && neighborPhones[i].value) {
                    neighbors.push({
                        name: neighborNames[i].value,
                        phone: neighborPhones[i].value
                    });
                }
            }
            if (neighbors.length > 0) {
                data.neighbors = neighbors;
            }
            
            // Save to database (mock - replace with actual API call)
            towerDatabase[towerId] = data;
            
            // Show success message with summary
            const fieldCount = Object.keys(data).length;
            showMessage('saveMessage', `‚úÖ Data saved for Tower ${towerId}. ${fieldCount} fields saved.`, 'success');
            
            // Optional: Log to console for debugging
            console.log('Saved data:', data);
            
            // Here you would send to MongoDB via your backend API
            // Example: fetch('/api/save-tower', { method: 'POST', body: JSON.stringify(data) })
        });

        // Initialize with one neighbor field
        window.onload = function() {
            addNeighbor();
            
            // Set default values for read-only fields
            document.getElementById('operator').value = 'Telenor';
            document.getElementById('modulePower').value = '3000';
            document.getElementById('bankCapacity').value = '400';
        };
    </script>
</body>
</html>
